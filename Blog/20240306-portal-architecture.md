>Portal 框架架构实现

## 宏观层面

宏观层面是整个Portal 工程的架构优化

Portal（KV） 设计为一个单纯的KV Store 服务器，可以实现KV 的存储

但是具体KV 是什么格式、存储什么内容，以及如何给予KV Store 实现分布式集群的调度、管理、监控，这些需要专门的外围程序实现，不能耦合到Portal 中。在K8s 集群中etcd 也只是存储kv，集群的管理调度也不是etcd 来做的

据此，Portal 整个宏观架构还应该哪些角色（可以参考K8s、Spark）

1. Transfer 接收客户端请求
2. Scheduler 调度程序，是否增加这个角色，由它来实现全局的调度，K8s 中有没有这样的角色
3. Agent 负责在服务器上管理调度Worker
4. Worker 具体的业务进程


## 微观层面

回到Portal KV 服务器上面，其代码架构该怎么设计，简单的顺序编程会导致程序变得又臭又长！

简单梳理了一下，应该如此去优化Portal KV 的架构：

1. 启动KV Store 端口监听，用于处理业务层的KV 存储
2. 启动Raft 端口监听，用于实现Raft 层的通信
3. 协议也分为两层，第一层是KV 业务层，第二层是Raft 底层
4. 网络协议的解析是需要独立于网络通信单独存在的
5. 网络通信，对epoll IO 多路复用进行封装，单独存在，只考虑发送、接收，不考虑具体协议的解析

切忌把所有功能都堆砌在一起！
